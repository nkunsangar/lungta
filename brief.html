<!DOCTYPE html>
<html>
<head>
<title>Лунгта - проект Северного Кунсангара</title>
<meta name="viewport" content="width=device-width, initial-scale=1">	
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
<link href="css/formValidation.css" rel='stylesheet' type='text/css' />
<link href="css/style.css" rel='stylesheet' type='text/css' />
<link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
<script src="js/jquery.min.js"></script>
<!---- start-smoth-scrolling---->
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/move-top.js"></script>
<script type="text/javascript" src="js/easing.js"></script>
<script type="text/javascript" src="js/formValidation.min.js"></script>
<script type="text/javascript" src="js/framework/bootstrap.min.js"></script>
<script type="text/javascript" src="js/language/ru_RU.js"></script>
<script type="text/javascript" src="js/jquery.jqgoogleforms.js"></script>
</head>
<body>
      <div class="briefbanner" id="home">
		<div class="container">
			<div class="header">
				<div class="header-left">
					<h1><a href="index.html"><h3 style="color:white; font-weight: bold; ">ЛУНГТА</h3><!--img src="images/logo.png" alt=""--></a></h1>
				</div>
				<div class="menu">
                                     <a class="toggleMenu" href="#"><img src="images/menu1.png" alt="" /> </a>
					<ul class="nav" id="nav">
					<!--li><a class="active" href="#home" class="scroll">Домой</a></li-->
					<li><a href="#news" class="scroll">О Лунгта</a></li>
					<li><a href="#order" class="scroll">Заказать</a></li>
					<li><a href="#contact" class="scroll">Контакты</a></li>
					<!--li><a href="#" class="scroll"><span class="twitter"></span></a></li>
					<li><a href="#" class="scroll"><span class="facebook"></span></a></li-->
					</ul>
                                  <!----start-top-nav-script---->
		                      <script type="text/javascript" src="js/responsive-nav.js"></script>
					<script type="text/javascript">
					jQuery(document).ready(function($) {
						$(".scroll").click(function(event){		
							event.preventDefault();
							$('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
						});
					});
					</script>
		<!----//End-top-nav-script---->
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
	</div>
	<div class="gallery" id="order">
		<div class="container">
			<h2>Закажите Лунгта</h2>
			<form id="orderForm" method="POST" action=".">
				<div class="gallery-main">
	
					<div class="gallery-top form-group">
						<div class="gallery-top-img">
							<label class="image-toggler">
	                                                        <input type="radio" name="lungtaImage" value="korva">&nbsp;<img src="images/korva-tontrug.png" alt="">
	                                                        <span>Корва Тонтруг</span>
	                        </label>
						</div>
						<div class="gallery-top-img">
							<label class="image-toggler">
	                                                        <input type="radio" name="lungtaImage" value="vajrasattva">&nbsp;<img src="images/vajrasattva.png" alt="">
	                                                        <span>Ваджрасаттва Яб-Юм</span>
	                        </label>
						</div>
						<div class="gallery-top-img">
							<label class="image-toggler">
	                                                        <input type="radio" name="lungtaImage" value="songvajra">&nbsp;<img src="images/pv.png" alt="">
	                                                        <span>Песня Ваджра</span>
	                        </label>
						</div>
						<div class="clearfix"></div>
					</div>
				</div>
				<div class="form-group">
					<label for="orderQuantity">Количество флажков</label>
					<input type="text" class="form-control" name="orderQuantity" id="orderQuantity" placeholder="Количество флажков должно быть кратно 5">
					<div>Требуемые комплекты: <span id="orderSets"></span> </div>
					<input type="hidden" name="orderSets">
				</div>
				<div class="form-group">
					<label for="orderName">Имя</label>
					<input type="text" class="form-control" name="orderName" id="orderName" placeholder="Введите ваше имя">
				</div>
				<div class="form-group">
					<label for="orderEmail">E-mail</label>
					<input type="email" class="form-control" name="orderEmail" id="orderEmail" placeholder="Введите ваш e-mail">
				</div>
				<div class="form-group">
					<label for="orderPhone">Телефон</label>
					<input type="text" class="form-control" name="orderPhone" id="orderPhone" placeholder="Введите номер вашего телефона">
				</div>
				<div class="form-group">
					<label for="orderComments">Ваши пожелания к заказу</label>
					<textarea class="form-control" name="orderComments" id="orderComments" placeholder="Введите ваши пожелания"></textarea>
				</div>
				<div class="form-group">
					<label for="orderCost">Стоимость заказа</label>
					<span class="form-control" name="orderCost" id="orderCost"></span>
				</div>
				<button type="submit" class="btn btn-primary">Заказать лунгта</button>
					<div class="gallery-bottom" id="contact">
						<div class="col-md-6 gallery-bottom-text">
							<p>Условия по оплате и получения заказа. Условия по оплате и получения заказа. Условия по оплате и получения заказа. Условия по оплате и получения заказа. Условия по оплате и получения заказа.</p>
	   					</div>
						<div class="col-md-6 gallery-bottom-text">
							<h4>Наши реквизиты:</h4>
							<p><b>карта Сбербанка РФ</b>: 5469 5500 2968 1548 </p>
							<p><b>кошелек Яндекс.Денег</b>: 410011675199385</p>

	   					</div>
						<div class="clearfix"></div>
					</div>
			</form>
		</div>
	</div>
	<div class="footer">
		<div class="container">
   			<div class="footer-main">
				<div class="col-md-6 footer-main-left">
					<h3>ЛУНГТА</h3>
					<div class="footer-bottom">
                       <!--div class="col-md-6 footer-bottom-left">
							<p class=active>Production time</p>
							<p>Questions and answers </p>
							<p>Payment methods</p>
						</div>
						<div class="col-md-6 footer-bottom-left">
							<p>Shipping information</p>
							<p>Feedback</p>
							<p>User agreement</p>
						</div-->
						<div class="clearfix"></div>
					</div>
                                     <div class="clearfix"></div>
				</div>
				<div class="col-md-6 footer-main-right">
					<!--ul>
					<li><a href="#"><span class="facebook"></span></a></li>
					<li><a href="#"><span class="twitter"></span></a></li>
					<li><a href="#"><span class="dribble"></span></a></li>
             				<li><a href="#"><span class="google"></span></a></li>
					</ul-->
					<p>&copy; 2016 Северный Кунсангар.</p>
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
                <script type="text/javascript">
					$(document).ready(function() {
										/*
										var defaults = {
								  			containerID: 'toTop', // fading element id
											containerHoverID: 'toTopHover', // fading element hover id
											scrollSpeed: 1200,
											easingType: 'linear' 
								 		};
										*/
										
										$().UItoTop({ easingType: 'easeOutQuart' });
										
									    $('.image-toggler').click(function(){
									        //$('.image-toggle').hide();
									        //$($(this).attr('data-image-id')).show();
									    });
									    
									    
									    
									    $('#orderQuantity').change(orderQuantityChange);
									    $('#orderQuantity').keypress(orderQuantityChange);
									    

										$('#orderForm')
									        .on('init.field.fv', function(e, data) {
									            var field  = data.field,        // Get the field name
									                $field = data.element,      // Get the field element
									                bv     = data.fv;           // FormValidation instance
									
									            // Create a span element to show valid message
									            // and place it right before the field
									            var $span = $('<small/>')
									                            .addClass('help-block validMessage')
									                            .attr('data-field', field)
									                            .insertAfter($field)
									                            .hide();
									
									            // Retrieve the valid message via getOptions()
									            var message = bv.getOptions(field).validMessage;
									            if (message) {
									                $span.html(message);
									            }
									        })
									        .formValidation({
									        	framework: 'bootstrap',
									            icon: {
									                valid: 'glyphicon glyphicon-ok',
									                invalid: 'glyphicon glyphicon-remove',
									                validating: 'glyphicon glyphicon-refresh'
									            },
									            fields: {
									                orderQuantity: {
									                    validators: {
									                        integer: {
									                            message: 'Введите число',
									                        },
									                        greaterThan: {
									                            message: 'Минимум 5 штук',
									                            value: 5,
									                        },
									                        notEmpty: {
									                            message: 'Введите число',
									                        },
									                        callback: {
									                        	message: 'Количество флажков должно быть кратно 5',
									                        	callback: orderQuantityValidate
									                        }
									                    }
									                },
									                orderName: {
									                    validators: {
									                        stringLength: {
									                            message: 'Введите ваше имя',
									                            min: 2,
									                            trim: true
									                        },
									                        notEmpty: {
									                            message: 'Введите ваше имя',
									                        },
									                    }
									                },
									                orderEmail: {
									                    validators: {
									                        emailAddress: {
									                            message: 'E-mail неверный'
									                        },
									                        notEmpty: {
									                            message: 'Введите e-mail',
									                        },
									                    }
									                },
									                orderPhone: {
									                    validators: {
									                        notEmpty: {
									                            message: 'Введите номер телефона',
									                        },
									                    }
									                },									             
									                lungtaImage: {
									                    validators: {
									                        notEmpty: {
									                            message: 'Выберите лунгта',
									                            callback: lungtaCheck
									                        }
									                    }
									                }
									            }
									        })
									        .on('success.field.fv', function(e, data) {
									            var field  = data.field,        // Get the field name
									                $field = data.element;      // Get the field element
									
									            // Show the valid message element
									            $field.next('.validMessage[data-field="' + field + '"]').show();
									        })
									        .on('err.field.fv', function(e, data) {
									            var field  = data.field,        // Get the field name
									                $field = data.element;      // Get the field element
									
									            // Show the valid message element
									            $field.next('.validMessage[data-field="' + field + '"]').hide();
									        });									    
									        
									        $('[type="submit"]').click(function(e) {
									        	e.preventDefault();
									        	
									        	var url = "http://www.kunsangar.ru/lungta_orders/new_order.php";
									        	
												$.ajax({
													type: "POST",
													url: url,
													data: $('#orderForm').serialize(),
													success: function(data) {
													  try {
															data = $.parseJSON(data);
													  }
													  catch(e)
													  {
													    data = null;
													  }
														// console.log(data);
														// console.log(typeof data);
														if (data.error != undefined) {
															$('#orderReport .modal-title').html('Ошибка');
												        	$('#orderReport').html('Ошибка: ' + data.error);
												        	$('#orderModal').modal();
														}
														else {
															$('#orderReport .modal-title').html('Заказ получен');
												        	$('#orderReport').html('Спасибо! Ваш заказ получен. Номер вашего заказа: ' + data.order_id);
												        	$('#orderModal').modal();
											        	}
													},
													error: function(data) {
													  try {
															data = $.parseJSON(data);
													  }
													  catch(e)
													  {
													    data = null;
													  }
														// console.log(data);
														$('#orderReport .modal-title').html('Ошибка');
											        	$('#orderReport').html('Ошибка во время отправления информации о заказа. Попробуйте позже');
											        	$('#orderModal').modal();
													}
												});
									        	
									        	
									        	/*var googleForm = $(window).jqGoogleForms({"formKey": "1Xbm67_Mo-F8jjZ4fAszqj95uuxzoNgsl1-Uz4NMdkVI"});
									        	
									        	googleForm.sendFormData({
												    "entry.1173043200": "some data",
												    "entry.1617284232": "some more data"
												});*/
									        });
										
					});
						
									function lungtaCheck(value, validator, $field) {
										return false;
									}
									
									function orderQuantityValidate(value, validator, $field) {
									    // value is the value of field
									    // validator is instance of BootstrapValidator
									    // $field is the jQuery object representing the field element

										var q = parseInt(value);
										if (isNaN(q))
											return true;
										if (q < 5)
											return true;
									    return (q/5.0 == parseInt(q/5));
									}

									function orderQuantityChange() {
										var el = $(this);
										setTimeout(function() {
									    	var q = el.val();
									    	//alert(q);
									    	q = parseInt(q);
									    	var n5 = 0, n15 = 0, n25 = 0, n50 = 0;
									    	$('#orderSets').html('');
									    	$('[name="orderSets"]').val('');
									    	$('#orderCost').html('');
									    	if (q >= 5 && q/5.0 == parseInt(q/5)) {
									    		while (q > 0) {
									    			if (q >= 50) {
									    				q -= 50;
									    				n50++;
									    			}
									    			else if (q >= 25) {
									    				q -= 25;
									    				n25++;
									    			}
									    			else if (q >= 15) {
									    				q -= 15;
									    				n15++;
									    			}
									    			else if (q >= 5) {
									    				q -= 5;
									    				n5++;
									    			}
									    			if (q < 5)
									    				break;
									    		}
									    		var sets = "";
									    		if (n5 > 0)
									    			sets += n5 + ' по 5 флажков, ';
									    		if (n15 > 0)
									    			sets += n15 + ' по 15 флажков, ';
									    		if (n25 > 0)
									    			sets += n25 + ' по 25 флажков, ';
									    		if (n50 > 0)
									    			sets += n50 + ' по 50 флажков, ';
									    		sets = sets.substring(0, sets.length-2);
									    		$('#orderSets').html(sets);
									    		$('[name="orderSets"]').val(sets);
									    		var price = n5 * 150 + n15 * 300 + n25 * 500 + n50 * 900;
									    		$('#orderCost').html(price + ' рублей');
									    	}
									    });
								    }
								    
								    
									
				</script>
					<a href="#" id="toTop" style="display: block;"> <span id="toTopHover" style="opacity: 1;"> </span></a>
		</div>
		
<div id="orderModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
		<div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Заказ получен</h4>
        </div>
        <div class="modal-body">
          <p id="orderReport">This is a small modal.</p>
        </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть окно</button>
	      </div>
    </div>
  </div>
</div>
		
</body>
</html>